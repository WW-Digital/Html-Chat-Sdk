var bc;(bc=window.bc=window.bc||{}).ApiFrame=function(e,t,a){var i=!!bc.config.serverSet||""===bc.config.serverSet;this.accountId=e,this.frame=t,this.frameLoadQueue=[],this.framePendingResults={},this.serverSet=i?bc.config.serverSet:a||"",this.frameOrigin="https://api"+this.serverSet+".boldchat.com",this.messageListener=null,this.id=1,this.isFrameLoaded=!1,this.retryTimeout=15e3,this.initialize()},bc.ApiFrame.prototype.initialize=function(){this.frame||(this.frame=bc.util.createElement("iframe",{class:"bc-api-frame",src:"about:blank",frameborder:0,style:"float: right; width: 1px; height: 1px; visibility: hidden"}),document.body.appendChild(this.frame)),this.frame&&this.frame.setAttribute("src",this.frameOrigin+"/aid/"+this.accountId+"/ext/api/apiframe.html");function e(e){t._receiveApiMessage(e)}var t=this;window.addEventListener?window.addEventListener("message",e):window.attachEvent("message",e)},bc.ApiFrame.prototype.setMessageListener=function(e){this.messageListener=e},bc.ApiFrame.prototype._receiveApiMessage=function(t){if(t.origin===this.frameOrigin){var e={};try{e=JSON.parse(t.data)}catch(e){bc.util.log(t.data,!0),bc.util.log(e,!0)}var a=e.method;if(a)if("loaded"===a){var i=this.frameLoadQueue.shift();for(this.isFrameLoaded=!0;i;)this._callRestObj(i),i=this.frameLoadQueue.shift();var n=this;setInterval(function(){var e=(new Date).getTime();for(var t in n.framePendingResults){var a=n.framePendingResults[t],i=a.time;Math.min(n.retryTimeout*a.tries,6e4)<e-i&&n._callRestObj(a.rest,a.tries)}},this.retryTimeout)}else this.messageListener(e.method,e.params,e.id);else{var s=this.framePendingResults[e.id];s&&(e.error?bc.util.log("** pending failed : _receiveApiMessage",e,s):(delete this.framePendingResults[e.id],s.rest.callback.finished(e)))}}},bc.ApiFrame.prototype.call=function(e,t){return this._callRestObj({request:{method:e,params:t,id:this.id++},callback:new bc.Rpc})},bc.ApiFrame.prototype._callRestObj=function(e,t){if(this.isFrameLoaded){"connect"!==e.request.method&&"disconnect"!==e.request.method&&(this.framePendingResults[e.request.id]={time:(new Date).getTime(),rest:e,tries:(t||0)+1});try{this.frame.contentWindow.postMessage(JSON.stringify(e.request),this.frameOrigin)}catch(e){console.log(e)}}else this.frameLoadQueue.push(e),bc.util.log("** adding to frameLoadQueue : _callRestObj",!1,e);return e.callback},(bc=window.bc=window.bc||{}).subscriber=function(n,e){var s={};n.subscribe=function(e,t){return s[e]=s[e]||[],s[e].push(t),n},n.unsubscribe=function(e,t){for(var a=0;s[e]&&a<s[e].length;a++)s[e][a]===t&&s[e].splice(a,1);return n},n.fireEvent=function(e){for(var t=Array.prototype.slice.call(arguments,1),a=s[e],i=0;a&&i<a.length;i++)if(bc.config.throwErrors)a[i].apply(n,t);else try{a[i].apply(n,t)}catch(e){bc.util.log(e)}return n};for(var a=0;a<e.length;a++)n[e[a]]=function(){var t=e[a];return function(e){return n.subscribe(t,e)}}()},bc.Rpc=function(){var t=this;return bc.subscriber(t,["success","failure"]),t.finished=function(e){e&&(e.error||"error"===e.Status||e.result&&"error"===e.result.Status)?t.fireEvent("failure",e.error||e.result&&e.result.Message||e.Message):t.fireEvent("success",e&&e.result||e)},t},bc.RpcError=function(t){var a=this;return a.success=function(){return a},a.failure=function(e){return e(t),a},a},bc.VisitorClient=function(a){var e=a.split(":"),t=e[0],i=null;3<e.length&&(i="-"+e[3],a=e.slice(0,3).join(":")),a=bc.util.base64(a);var s=new bc.ApiFrame(t,null,i);bc.subscriber(this,["updateChat","updateTyper","addMessage","autoMessage","updateBusy","beginActiveAssist","updateActiveAssist","reconnecting","chatEndedByOp","chatEnded","closed"]);function n(e,t){return g&&(t.ChatKey=g),t.auth=a,t.stream=!0,s.call(e,t)}function u(e,t){return g&&(t.ChatKey=g),t.auth=a,s.call(e,t)}function d(e){bc.util.createCookie(bc.config.chatCookie,g,.08),l=e.ClientID,s.call("connect",e),e.Brandings&&m.setBrandings(e.Brandings)}function r(){s.call("disconnect",{}),l=o=null,c.fireEvent("closed")}function h(e){bc.util.log(e)}var c=this,g=bc.util.readCookie(bc.config.chatCookie),m=null,b=g?"started":"create",l=null,o=null,f={},p=null,v={},y=!1;c.hasChatKey=function(){return!!g},c.getChatParams=function(){return m&&m.getChatParams()||{}},c.addChatParams=function(e){m.addChatParams(e)},c.getVisitInfo=function(){return m&&m.getVisitInfo()||{}},c.addVisitInfo=function(e){m.addVisitInfo(e)},c.updateVisitInfo=function(e){m.addVisitInfo(e)},c.getMessages=function(){return m.getMessages()},c.getPerson=function(e){return v[e]||m.getPeople()[e]||{}},c.getChat=function(){return p},c.getPostChatFormIfAvail=function(){c.finishChat().success(function(e){c.fireEvent("chatEnded",e)})},c.getLastMessageId=function(){return m.getLastMessageId()},c.isMinimized=function(){return m&&m.getMinimizedStatus()},c.changeMinimizedStatus=function(e){return m.changeMinimizedStatus(e)},c.chatContainsStatusMessage=!1;function C(e){!c.chatContainsStatusMessage&&e.PersonType&&"operator"===e.PersonType&&(c.chatContainsStatusMessage=!0)}f.updateChat=function(e){var t=e.Values;for(var a in p=p||{},t)t.hasOwnProperty(a)&&(p[a]=t[a])},f.updateTyper=function(e){V(e)},f.addMessage=function(e){bc.util.log("Received a message from the server",!1,e);var t=e.Values,a=e.MessageID;C(t),m.addMessage(a,t),V(e)},f.autoMessage=function(){},f.updateBusy=function(e){bc.util.log("Received an updateBusy message from the server: ",!1,e),m.setQueueIndicator(e)},f.beginActiveAssist=function(e){o=e.ActiveAssistID},f.updateActiveAssist=function(e){e.Values.Ended&&(o=null)},f.startChat=function(){"started"!==b||y||c.startChat()},f.finishChat=function(){bc.util.log("messageHandler.finishChat"),"started"!==b||y||c.fireEvent("chatEndedByOp")},f.chatEndedByOp=function(){bc.util.log("client:messageHandlers.chatEndedByop")},f.chatEnded=function(){bc.util.log("chatEnded")},f.reconnecting=function(){c.fireEvent("reconnecting")},c.handleMessage=function(e,t){bc.util.log("messageHandler.handleMessage:method = ",!1,e),bc.util.log("messageHandler.handleMessage:params = ",!1,t);var a=f[e];a&&a(t),c.fireEvent(e,t)},s.setMessageListener(c.handleMessage),c.getChatAvailability=function(e){return u("getChatAvailability",{VisitorId:e||null}).failure(h)},c.createChat=function(e,t,a,i,n,s,r,c){if("create"!==b)return new bc.RpcError("You can only call createChat once");var l={VisitorID:e,Language:t,IncludeBrandingValues:!0,SkipPreChat:a,Data:JSON.stringify(i),Secured:n,ButtonID:s,ChatUrl:r,CustomUrl:c},o=function(){var e=bc.util.readRawCookie(bc.config.chatRecoverCookie);if(e){return{chatKey:e.split(":")[0]}}return null}();return o&&(l.ChatKey=o.chatKey),u("createChat",l).failure(h).success(function(e){"function"==typeof bc.setOverrides&&bc.setOverrides(),g=e.ChatKey,(m=new bc.SessionStorage(g)).setBrandings(e.Brandings),"started"===(b=e.UnavailableReason?"unavailable":e.PreChat?"prechat":"started")&&d(e),M()})},c.cancelChat=function(){bc.util.eraseCookie(bc.config.chatCookie),bc.util.eraseCookie(bc.config.configCookie)},c.submitUnavailableEmail=function(e,t,a){return"unavailable"!==b?new bc.RpcError("You can only submit the unavailable form on the unavailable form"):u("submitUnavailableEmail",{From:e,Subject:t,Body:a}).failure(h).success(function(){b="unavailable_submitted"})},c.submitPreChat=function(e){return"prechat"!==b?new bc.RpcError("You can only submit a pre chat when on the pre chat"):u("submitPreChat",{Data:JSON.stringify(e)}).failure(h).success(function(e){"started"===(b=e.UnavailableReason?"unavailable":e.PreChat?"prechat":"started")&&d(e)})},c.changeLanguage=function(e){return"prechat"!==b?new bc.RpcError("You can only change language on the pre chat form"):u("changeLanguage",{Language:e}).failure(h).success(function(e){e.Brandings&&m.setBrandings(e.Brandings)})},c.startChat=function(){if("started"!==b&&!g)return bc.util.eraseCookie(bc.config.chatCookie),new bc.RpcError("You can only start a chat once it is started (needs a chat key from createChat)");s.call("disconnect",{}),"function"==typeof bc.setOverrides&&bc.setOverrides();var e={};if(!m&&g){(m=new bc.SessionStorage(g)).getBrandings()||(e.IncludeBrandingValues=!0);var t=m.getMessages();try{for(var a=0;a<t.length;a++)C(t[a]),t[a].IsReconstitutedMsg=!0,c.fireEvent("addMessage",{MessageID:t[a].MessageID,Values:t[a]});e.LastChatMessageID=m.getLastMessageId()}catch(e){bc.util.log(e,!0)}var i=m.getQueueIndicator();try{var n={Position:i.Position,UnavailableFormEnabled:i.UnavailableFormEnabled};c.fireEvent("updateBusy",n)}catch(e){bc.util.log(e,!0)}}return E||M(),u("startChat",e).success(d).failure(function(e){bc.util.eraseCookie(bc.config.chatCookie),h(e)})},c.visitorTyping=function(e){return"started"!==b?new bc.RpcError("You cannot change typing state if the chat is not active"):n("visitorTyping",{IsTyping:e}).failure(h)},c.sendMessage=function(e,t,a){if("started"!==b)return new bc.RpcError("You cannot send messages if the chat is not active");var i={Name:e,Message:t,ChatMessageID:a||bc.util.getId()};return n("sendMessage",i).failure(function(e){h("bc-client.sendMessage error:"),h(e)})},c.emailChatHistory=function(e){return"started"!==b&&"postchat"!==b&&"done"!==b?new bc.RpcError("You cannot email the chat before it is started"):n("emailChatHistory",{EmailAddress:e}).failure(h)},c.finishChat=function(){return"started"!==b?(I(),new bc.RpcError("You cannot finish the chat unless it is started")):(y=!0,u("finishChat",{ClientID:l}).failure(function(e){I(),h(e)}).success(function(e){r(),bc.util.eraseCookie(bc.config.chatCookie),bc.util.eraseCookie(bc.config.configCookie),b=e.PostChat?"postchat":"done"}))},c.getUnavailableForm=function(){return"started"!==b?new bc.RpcError("You cannot get the unavailable form unless the chat has started"):(y=!0,u("getUnavailableForm",{ClientID:l}).failure(h).success(function(){r(),b="unavailable"}))},c.acceptActiveAssist=function(){return o?n("acceptActiveAssist",{ClientID:l,ActiveAssistID:o}).failure(h):new bc.RpcError("There is no active assist to accept")},c.cancelActiveAssist=function(){return n("cancelActiveAssist",{ClientID:l,ActiveAssistID:o}).failure(h)},c.submitPostChat=function(e){return"postchat"!==b?new bc.RpcError("Cannot call post chat when not on the post chat"):u("submitPostChat",{Data:JSON.stringify(e)}).failure(h).success(function(e){b=e.PostChat?"postchat":"done"})},c.getState=function(){return b},c.isStarted=function(){return"started"===b},c.setState=function(e){b=e},c.getBrandings=function(){return m.getBrandings()};function w(){}var E=null,M=function(e){E=setTimeout(function(){L()},e||3e4)},I=function(){bc.util.log("Stopping ping chat loop"),clearTimeout(E)},B=0,L=function(){if("create"!==b&&"done"!==b)return u("pingChat",{Closed:!1}).success(function(){M(3e4),B=0}).failure(function(){++B<50&&M(5e3)});bc.util.log("Exiting ping chat loop state = "+b),clearTimeout(E),E=null},V=function(e){var t=e.Values&&e.Values.PersonID||e.PersonID;e.Values&&t&&(v[t]=v[t]||m.getPeople()[t]||{},e.Values.ImageURL&&(v[t].Avatar=e.Values.ImageURL),e.Values.Name&&(v[t].Name=e.Values.Name),m.setPeople(v))};return c.setEmailTranscript=function(e){return"started"!==b?new bc.RpcError("You cannot get the unavailable form unless the chat has started"):g?u("emailChatHistory",{ChatKey:g,EmailAddress:e}).failure(h):void 0},window.addEventListener?window.addEventListener("beforeunload",w,!1):window.attachEvent("onbeforeunload",w),c},(bc=window.bc=window.bc||{}).FormBuilder=function(x){function q(e){var t=bc.util,a=t.createElement("div",{class:"bc-input-container"});return t.addClass(a,e),a}var K=this;this.createPlaceholder=function(e,t,a,i){var n=bc.util.isNodeList(e)?e[0]:e;n.name=n.id;var s=bc.util.createElement("label",{class:"bc-input-label",for:n.id,"data-l10n":a},t+(i||""));i&&s.setAttribute("data-l10n-suffix",i);var r=bc.util.createElement("div",{class:"bc-input-placeholder"});return bc.themeConfig&&bc.themeConfig.placeholdersOnInputFields&&bc.util.setAttribute(n,"data-l10n-placeholder",a),bc.themeConfig&&bc.themeConfig.labelsAfterInputFields?(r.appendChild(n),r.appendChild(s)):(r.appendChild(s),r.appendChild(n)),r},this.createErrorForm=function(e,t){"use strict";var a,i,n=bc.util.createElement("form",{class:"bc-form"});if(e){var s=q("bc-form-intro");x.hasLocalizedValues()&&s.appendChild((a=e,i=x.getLocalizedValue(e),bc.util.createElement("div",{class:"bc-error bc-bold","data-l10n":a},i||a))),n.appendChild(s)}return t&&n.appendChild(bc.util.createElement("div",{class:"bc-error"},t)),n},this.createSelectOptions=function(e,t){var a,i,n={},s=bc.util;if(t.Options&&t.Options.length)for(var r=0,c=t.Options.length;r<c;r++){var l=t.Options[r],o=s.createElement("option",{value:l.Value},l.Name);if(t.ShowDepartmentStatus&&l.AvailableLabel)if(n[l.AvailableLabel])n[l.AvailableLabel].appendChild(o);else{var u=s.createElement("optgroup",{label:l.AvailableLabel,"data-l10n":l.AvailableLabelBranding});u.appendChild(o),l.Available&&i?e.insertBefore(u,i):(i||(i=u),e.appendChild(u)),n[l.AvailableLabel]=u}else e.appendChild(o);l.Default&&(o.setAttribute("selected","selected"),a=o)}return a},this.createForm=function(e,t,b,a,i,s,n,r,c){"use strict";var o=document.createElement("form"),f={};o.setAttribute("class","bc-form"),o.setAttribute("novalidate","");function p(e){if(e&&(!e.nodeName||"input"!==e.nodeName.toLowerCase()||"radio"!==e.tagName.toLowerCase()))return e.nodeName&&"select"===e.nodeName.toLowerCase()?!e.selectedIndex&&0!==e.selectedIndex||!e.options||e.options[e.selectedIndex].disabled?"":e.options[e.selectedIndex].value:e.value}function l(e){return/\S+@\S+\.\S+/.test(e)}function u(e){var t,a=!0,i={},n=null,s={};for(var r in f){var c=f[r],l=document.getElementById(c.ElementId),o=p(l);if(c.Valid=!0,o&&(c.ValidationKeyGroup&&c.ValidationFunc&&"function"==typeof c.ValidationFunc&&(c.Valid=c.ValidationFunc(o)),c.Valid&&(i[r]=o)),e&&(!c.Valid||c.Required&&!i[r]))if(a=!1,n||(t=l),bc.util.toggleClass(bc.util.closest(l,".bc-input-container"),"bc-invalid",!0),c.Valid)(n=n||document.createElement("ul")).appendChild(bc.util.createElement("li",{"data-l10n":c.LabelKey},c.Label));else{var u=s[c.ValidationKeyGroup]||[];u.push(c),s[c.ValidationKeyGroup]=u}}if(e){if(!a){if(S.innerHTML="",n&&(S.appendChild(bc.util.createElement("span",{"data-l10n":b||"api#generic#required_fields"},x.getLocalizedValue("api#generic#required_fields")||"Please fill in the required fields!")),S.appendChild(n)),s)for(var d in s){S.appendChild(bc.util.createElement("span",{"data-l10n":d},x.getLocalizedValue(d)||"Please enter a valid value: "));for(var h=document.createElement("ul"),g=0;g<s[d].length;g++){var m=s[d][g];h.appendChild(bc.util.createElement("li",{"data-l10n":m.LabelKey},m.Label))}S.appendChild(h)}x.updateLocalizedValues(S)}bc.util.toggleVisibility(S,!a),t&&t.focus()}return{valid:a,values:i}}function h(t,e,a,i,n,s,r){var c="bc-input-"+(65536*(1+Math.random())|0).toString(16),l=!0;t.id=c,t.nodeName&&"input"===t.nodeName.toLowerCase()&&"radio"===t.tagName.toLowerCase()&&(f[e]?(t.name=f[e].ElementId,l=!1):t.name=c),bc.util.addEventListener(t,"change",function(){var e=bc.util.closest(t,".bc-input-container");bc.util.removeClass(e,"bc-invalid"),u(bc.util.hasClass(o.parentNode,"bc-invalid")).valid&&bc.util.removeClass(o,"bc-invalid")}),l&&(f[e]={ElementId:c,Required:a,Label:i,LabelKey:n,ValidationKeyGroup:s,ValidationFunc:r})}function d(e,t){var a,i,n=bc.util.createElement("input",{type:t,value:e.Value||""});return n.addEventListener("change",function(){bc.util.toggleClass(this,"bc-not-empty",!!this.value)}),e.Value&&0<e.Value.length&&bc.util.toggleClass(n,"bc-not-empty",!0),bc.util.toggleVisibility(n,!(!1===e.ShowSelector)),"email"===t&&(a="api#email#error",i=l),h(n,e.Key,!!e.Required,e.Label,e.LabelBranding,a,i),e.Label&&(n=K.createPlaceholder(n,e.Label,e.LabelBranding,e.Required?T:null)),"email"===t&&r?function(e,t,a){var i=document.createElement("div");if(i.appendChild(bc.util.createElement("div",{class:"bc-help-message","data-l10n":a})),i.appendChild(e),t.Value&&0<t.Value.length){var n=e.querySelector("input");n&&(n.value=t.Value,n.className+=" bc-not-empty")}return i}(n,e,r):n}function g(t){var a=bc.util,e=document.createElement("select");e.addEventListener("change",function(e){a.toggleClass(this,"bc-not-empty",0<this.selectedIndex),"language"===t.Key&&e.target&&e.target.options&&void 0!==e.target.selectedIndex&&s(e.target.options[e.target.selectedIndex].value)}),a.toggleVisibility(e,!(!1===t.ShowSelector)),h(e,t.Key,!!t.Required,t.Label,t.LabelBranding);var i=K.createSelectOptions(e,t);if(t.Label){var n=a.createElement("option",{disabled:!0,"data-l10n":t.LabelBranding},t.Label+(t.Required?T:""));t.Required&&n.setAttribute("data-l10n-suffix",T),e.insertBefore(n,e.firstChild),i||(e.selectedIndex=0),bc.util.toggleClass(e,"bc-not-empty",!!i)}return e}function m(e){var t=bc.util,a=e.Key||Math.random().toString(),i="bc-star-"+a,n=t.createElement("div",{class:"bc-starrating-component"}),s=t.createElement("input",{type:"hidden"});h(s,e.Key,!!e.Required,e.Label,e.LabelBranding),n.appendChild(s);for(var r=5;0<r;r--){var c="bc-star-"+a+r.toString(),l=t.createElement("input",{id:c,class:"bc-star-val",type:"radio",name:i,value:r.toString(),tabindex:0});l.addEventListener("change",function(e,t){var a,i,n;a=e,i=s.id,(n=a.target||a.srcElement).parentElement.querySelector("#"+i).value=n.value}),n.appendChild(l),n.appendChild(t.createElement("label",{for:c,class:"bc-star",title:r.toString(),tabindex:0}))}var o=t.createElement("div",{class:"bc-label-and-star"});return o.appendChild(t.createElement("label",{class:"bc-star-label"},e.Label||a)),o.appendChild(n),o}function v(e,i){return function(){for(var e=document.getElementsByClassName("bc-checked-radio"),t=0;t<e.length;t++)bc.util.toggleClass(e[t],"bc-checked-radio",!1);bc.util.addClass(this,"bc-checked-radio");var a=document.getElementById(i);a&&(a.value=this.id.substring(3))}}function y(e){return"nps"===e.Key?function(e){var t=bc.util,a=document.createElement("div"),i=t.createElement("div",{class:"bc-nps-interface"}),n=t.createElement("div",{class:"bc-nps-header"}),s=t.createElement("div",{class:"bc-nps-radios"}),r=t.createElement("input",{type:"hidden",name:"bc-record-survey-nps"});if(h(r,e.Key,!!e.Required,e.Label,e.LabelBranding),e.Label){var c=t.createElement("div",{class:"bc-help-message","data-l10n":e.LabelBranding},e.Label+(e.Required?T:""));e.Required&&c.setAttribute("data-l10n-suffix",T),a.appendChild(c)}if(e.Options&&e.Options.length){for(var l=0,o=e.Options.length;l<o;l++){var u=e.Options[l];0===l?n.appendChild(t.createElement("div",{class:"bc-nps-message-left"},u.Name.replace("0 - ",""))):l===e.Options.length-1&&n.appendChild(t.createElement("div",{class:"bc-nps-message-right"},u.Name.replace("10 - ","")));var d=t.createElement("div",{class:"bc-radio-container bc-unchecked-radio",id:"rad"+l},l.toString());d.addEventListener("click",v(0,r.id)),s.appendChild(d)}i.appendChild(n),i.appendChild(t.createElement("div",{class:"bc-clear"})),i.appendChild(s),i.appendChild(t.createElement("div",{class:"bc-clear"}))}return a.appendChild(i),a.appendChild(r),a}(e):g(e)}function C(){o.addEventListener("submit",function(e){e.preventDefault(),function(){var e=u(!0);e.valid?(i&&"function"==typeof i?i(e.values):bc.util.log("submitCallback is not provided for the form"),bc.util.addClass(o,"bc-invalid")):bc.util.removeClass(o,"bc-invalid")}()})}function w(e){return bc.util.createElement("div",{"data-l10n":e})}var E,M,I,B,L,V,S=bc.util.createElement("div",{class:"bc-validator",style:"display: none"}),T=c||" *";if(e){var P=q("bc-form-intro"),A=w(e),F=x.getLocalizedValue(e);F||0!==F.length||(A.textContent=e),P.appendChild(A),o.appendChild(P)}if(o.appendChild(S),t&&t.Fields)for(var z=0,O=t.Fields.length;z<O;z++){var _=t.Fields[z],k="appendChild";_.Key===n&&(k="insertBefore");var N=q("nps"===(B=_).Key?"bc-nps-container":"email"===B.Key&&"label"===B.Type?"bc-center":null);switch(_.Type){case"text":_.MultiLine?N.appendChild((M=_,I=void 0,(I=bc.util.createElement("textarea",null,M.Value)).addEventListener("change",function(){bc.util.toggleClass(this,"bc-not-empty",!!this.value)}),M.Value&&0<M.Value.length&&bc.util.toggleClass(I,"bc-not-empty",!0),bc.util.toggleVisibility(I,!(!1===M.ShowSelector)),h(I,M.Key,!!M.Required,M.Label,M.LabelBranding),M.Label&&(I=K.createPlaceholder(I,M.Label,M.LabelBranding,M.Required?T:null)),I)):N.appendChild(d(_,"text")),o[k](N);break;case"email":N.appendChild(d(_,"email")),"insertBefore"===k?o[k](N,o.firstChild):o[k](N);break;case"phone":N.appendChild(d(_,"tel")),o[k](N);break;case"select":N.appendChild(g(_)),bc.util.addClass(N,"bc-input-container-select"),o[k](N);break;case"radio":var R=N.appendChild(y(_));"SELECT"===R.tagName&&bc.util.addClass(N,"bc-input-container-select"),N.appendChild(R),o[k](N);break;case"rating":N.appendChild(m(_)),o[k](N);break;case"label":N.appendChild((E=_,bc.util.createElement("label",{},E.Value))),o[k](N);break;default:bc.util.log("Form Builder: Not supported item type: "+_.Type)}_.Key===n&&r&&o[k](q().appendChild(w(r)))}if(a&&i&&"function"==typeof i){var D=q("bc-action-input-container");D.appendChild((L=a,(V=bc.util.createElement("button",{type:"submit",class:"bc-action-button bc-button","data-l10n":L})).innerHTML='<span class="bc-action-button-span">'+x.getLocalizedValue(L)+"</span>",C(),V)),o.appendChild(D)}return x.updateLocalizedValues(o),{form:o,formItems:f}},this.changeDepartments=function(e,t){var a=t[e.Key],i=document.getElementById(a.ElementId);i.innerHTML="",K.createSelectOptions(i,e),i.selectedIndex=0}},(bc=window.bc=window.bc||{}).Localizer=function(e){var u=this,t=e||{},a=!1;this.hasLocalizedValues=function(){return a},this.setLocalizationValues=function(e){a=!!e,t=e,u.updateLocalizedValues()},this.getLocalizedValue=function(e){return t[e]||""},this.updateLocalizedValues=function(e){for(var t=e?e.querySelectorAll("*[data-l10n]"):document.querySelectorAll("*[data-l10n]"),a=0;a<t.length;a++){if(l=(c=t[a]).getAttribute("data-l10n")){if(o=u.getLocalizedValue(l)){var i=c.getAttribute("data-l10n-suffix");switch(i&&(o+=i),c.nodeName){case"LABEL":c.children.length?bc.util.log("Not implemented",!0):c.innerHTML=o;break;case"OPTGROUP":c.setAttribute("label",o);break;case"INPUT":c.value=o;break;case"TEXTAREA":var n=c.getAttribute("data-l10n-placeholder");n?("useText"!==n&&(o=u.getLocalizedValue(n)),c.placeholder=o):c.innerHTML=o;break;default:c.innerHTML=o}}else bc.util.log("No localized text found for "+l,null);var s=c.getAttribute("data-l10n-prefix");if(s){var r=u.getLocalizedValue(s);r&&0<r.length&&(r+=" "),c.innerHTML=r+c.innerHTML}}}for(t=e?e.querySelectorAll("input[data-l10n-placeholder]"):document.querySelectorAll("input[data-l10n-placeholder]"),a=0;a<t.length;a++){var c,l,o;if(l=(c=t[a]).getAttribute("data-l10n-placeholder"))(o=u.getLocalizedValue(l))&&(c.placeholder=o)}}},(bc=window.bc=window.bc||{}).PersonType={Operator:"operator",Visitor:"visitor",System:"system"},Object.freeze&&Object.freeze(bc.PersonType),(bc=window.bc=window.bc||{}).SessionState={Idle:0,InitialLoading:1,PreChat:2,PreChatSending:3,ChatActive:4,ChatInactive:5,ChatEnding:6,PostChat:7,PostChatSending:8,UnavailableChat:9,UnavailableChatSending:10,Finished:11,Error:12},Object.freeze&&Object.freeze(bc.SessionState),(bc=window.bc=window.bc||{}).SessionStorage=function(a){function i(){if(bc.config&&!bc.config.messageCache)return!1;try{return bc.config&&bc.config.logging&&bc.util.log("sessionStorage available: "+!!window.sessionStorage),!!window.sessionStorage}catch(e){return bc.util.log(e,!0),!1}}function n(){if(s.lastUpdated=new Date,i())try{sessionStorage.bc=JSON.stringify(s),bc.util.log("Wrote to session storage")}catch(e){bc.util.log(e,!0)}}var s,r={};this.addMessage=function(e,t){var a=this._clone(t);a.MessageID=e,void 0!==r[e]?s.chat.messages[r[e]]=a:(s.chat.messages.push(a),r[e]=s.chat.messages.length-1,s.chat.lastMessageId=e),n()},this._clone=function(e){if("object"!=typeof e)return e||{};var t={};for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);return t},this.getLastMessageId=function(){return s.chat.lastMessageId},this.getMinimizedStatus=function(){return s.chat.isMinimized},this.changeMinimizedStatus=function(e){s.chat.isMinimized=e,n()},this.getMessages=function(){return s.chat.messages},this.getChatParams=function(){return s.chatParams},this.addChatParams=function(e){s.chatParams=e,n()},this.getVisitInfo=function(){return s.visitInfo},this.addVisitInfo=function(e){s.visitInfo=e,n()},this.getQueueIndicator=function(){return s.queueIndicator},this.setQueueIndicator=function(e){s.queueIndicator=e,n()},this.setBrandings=function(e){s.chat.brandings=e,n()},this.getBrandings=function(){return s.chat.brandings},this.setPeople=function(e){s.people=e,n()},this.getPeople=function(){return s.people||{}},function(){if(i()){var e;try{e=sessionStorage.bc}catch(e){bc.util.log(e)}if(e)try{s=JSON.parse(e);for(var t=0;t<s.chat.messages.length;t++)s.chat.messages[t].MessageID&&(r[s.chat.messages[t].MessageID]=t)}catch(e){bc.util.log("Failed to parse session storage: "+e),sessionStorage.removeItem("bc")}}s&&s.chat&&s.chat.chatKey===a||(s={chat:{chatKey:a,messages:[]},queueIndicator:{},chatParams:{},visitInfo:{},lastUpdated:new Date,isMinimized:"false"})}()},(bc=window.bc=window.bc||{}).Session=function(e,t,s,a){var r=this,i=0,n=null,c=null,l=!1,o=0;this.viewManager=a,this.client=new bc.VisitorClient(e),this.chatParams=t||{},this.visitorInfo=s||{};function u(e){r.viewManager.hideBusy(),r.viewManager.showError(e)}this.getApiKey=function(){return e},this.getVisitorId=function(){var e=document.location.href,t=this.visitorInfo.visitorId;if(!t){var a=e.indexOf("_bcvm_vrid_");if(-1!==a){var i=e.indexOf("=",a),n=e.indexOf("&",a);-1!==i&&(t=e.substring(i+1,-1===n?e.length:n))}}return t},this.getChatAvailability=function(t,e){this.client.getChatAvailability(r.getVisitorId()).success(function(e){t(e.Available,e.UnavailableReason)}).failure(e)};function d(e){var t="api#unavailable#no_operators",a="api#chat#close";e.UnavailableForm&&(e.UnavailableForm.Fields?(t="api#unavailable#intro",a="api#chat#send"):"unsecure"===e.UnavailableReason&&(t="api#unsecure#message")),r.viewManager.showForm(t,e.UnavailableForm,null,a,r._unavailableFormSubmitted)}function h(e,t){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])}function g(){if(!r.client.chatContainsStatusMessage){var e=null;(e=0!==i?r.viewManager.getLocalizedValue("api#chat#operators_busy"):r.viewManager.getLocalizedValue("api#chat#waiting_for_operator"))&&r.viewManager.showStatusMessage(e)}}function m(){if(r.client.isStarted()){var e=r.client.getChat();return null===e||!e.Answered&&!e.Ended&&!e.Closed}}function b(e){e&&(bc.util.log("Starting answer timeout for "+e+" seconds"),n&&(clearTimeout(n),n=null),m()&&(n=setTimeout(function(){bc.util.log("Answer timed out"),m()&&r.cancelQueueWait(),n=null},1e3*e)))}this.startChat=function(e,t,a){if(this.viewManager||(this.viewManager=new bc.ViewManager),this.viewManager.initialize(this),r.viewManager.showBusy(),this.client.hasChatKey())this.client.startChat().success(function(e){r.viewManager.showChatForm(),r.viewManager.hideBusy(),r.chatParams=r.client.getChatParams(),r.visitorInfo=r.client.getVisitInfo(),(e.Brandings||r.client.getBrandings())&&r.viewManager.setLocalizationValues(e.Brandings||r.client.getBrandings()),g()}).failure(function(e){bc.util.log("Failed to resume previous chat session: "+e,!0),r.viewManager.closeChat()});else{var i=setTimeout(function(){r.client.setState("error"),r.viewManager.hideBusy(),r.viewManager.showError("Error creating chat, please try again.")},15e3),n={};h(s,n),h(a,n),n.language=n.language||r.chatParams.language,this.client.createChat(r.chatParams.visitor||r.getVisitorId(),t||r.chatParams.language,e,n,r.chatParams.secure,r.chatParams.button,r.chatParams.url,r.chatParams.customUrl).success(function(e){clearTimeout(i),r.viewManager.setLocalizationValues(e.Brandings),r.chatParams&&r.client.addChatParams(r.chatParams),r.visitorInfo&&r.client.addVisitInfo(r.visitorInfo),r.viewManager.hideBusy(),e.PreChat?r.viewManager.showForm("api#prechat#intro",e.PreChat,null,"api#prechat#start",r._preChatFormSubmitted):e.UnavailableForm?d(e):(b(e.AnswerTimeout),r.viewManager.showChatForm(),g())}).failure(function(e){clearTimeout(i),u(e)})}},this.setLanguage=function(e){r.viewManager.showBusy(),this.client.changeLanguage(e).success(function(e){r.viewManager.hideBusy(),e.Brandings&&r.viewManager.setLocalizationValues(e.Brandings),e.Departments&&r.viewManager.changeDepartments(e.Departments)}).failure(u)},this.setVisitorTyping=function(e){this.client.visitorTyping(e)},this.addVisitorMessage=function(e){var t=bc.util.getId();return this.client.sendMessage(r.getVisitorName(),e,t),t},this.setEmailTranscript=function(e){this.client.setEmailTranscript(e)},this.cancelQueueWait=function(){r.viewManager.showBusy(),r.client.cancelChat(),r.client.getUnavailableForm().success(function(e){r.viewManager.hideQueueMessage(),r.viewManager.clearOperatorTypers(),r.viewManager.hideBusy(),d(e)}).failure(u)},this.endChat=function(){switch(r.viewManager.showBusy(),r.viewManager.hideChatInteraction(),r.client.getState()){case"error":case"prechat":case"postchat":case"unavailable":r.client.finishChat(),r.viewManager.closeChat(),r.viewManager.hideForm();break;default:r.client.finishChat().success(function(e){r._processChatEndData(e)}).failure(function(){r._processChatEndData()})}},this.getVisitorName=function(){return r.visitorInfo||(r.visitorInfo=r.client.getVisitInfo()),r.visitorInfo?r.visitorInfo.first_name||r.visitorInfo.name||r.visitorInfo.last_name:r.viewManager.getLocalizedValue("api#generic#you")},this.getOperatorName=function(){return r.viewManager.getLocalizedValue("api#chat#operator")},this._updateChat=function(e){(e.Values.Answered||e.Values.Ended)&&r.viewManager.hideStatusMessage(),e.Values.Ended&&r.viewManager.hideChatInteraction()},this._updateTyper=function(e){e.Values.PersonType===bc.PersonType.Operator&&(e.Values.IsTyping?r.viewManager.setOperatorTyping(e.Values.Name||r.getOperatorName(),e.Values.ImageURL,e.PersonID):r.viewManager.hideOperatorTyping(e.PersonID))},this._addMessage=function(e){var t=e.Values.ImageURL||r.client.getPerson(e.Values.PersonID).Avatar,a=e.Values.Name||r.client.getPerson(e.Values.PersonID).Name||r.getOperatorName();r.viewManager.addOrUpdateMessage(e.MessageID,e.Values.PersonType,a,new Date(e.Values.Created),e.Values.Text,t,e.Values.IsReconstitutedMsg,e.Values.OriginalText),c&&(clearTimeout(c),c=null);var i=r.client.getLastMessageId();(l&&o!==i||!i)&&(c=r.viewManager.notifyMinimizeButton()),(l=i===e.MessageID)&&(o=i)},this._autoMessage=function(e){r.client.chatContainsStatusMessage=!0,r.viewManager.showStatusMessage(e.Text)},this._updateBusyQueue=function(e){i=e.Position,e.Position<=0?r.viewManager.hideQueueMessage():e&&e.Position&&0<e.Position&&r.viewManager.showOrUpdateQueueMessage(e.Position,e.UnavailableFormEnabled),g()};this._preChatFormSubmitted=function(e){r.viewManager.hideForm(),r.viewManager.showBusy(),function(e){e.name?r.visitorInfo.name=e.name:e.first_name&&(r.visitorInfo.name=e.first_name),e.last_name&&(r.visitorInfo.last_name=e.last_name),e.email&&(r.visitorInfo.email=e.email),e.information&&(r.visitorInfo.information=e.information),e.initial_question&&(r.visitorInfo.initial_question=e.initial_question),e.language&&(r.visitorInfo.language=e.language),e.phone&&(r.visitorInfo.phone=e.phone),r.client.updateVisitInfo(r.visitorInfo)}(e),r.client.submitPreChat(e).success(function(e){r.viewManager.hideBusy(),e.UnavailableReason?d(e):(b(e.AnswerTimeout),r.viewManager.showChatForm(),g())}).failure(u)},this._postChatFormSubmitted=function(i){r.viewManager.hideForm(),r.viewManager.showBusy(),r.viewManager.hideCloseButton();var n=null;r.client.submitPostChat(i).success(function(){"use strict";var e=0;for(var t in i)i[t]&&i.hasOwnProperty(t)&&e++;var a="api#chat#ended";i.email&&1===e?(a="api#postchat#emailed",n={Fields:[{Key:"email",Type:"label",Value:i.email}]}):i.email&&1<e?(a="api#postchat#submitted_and_emailed",n={Fields:[{Key:"email",Type:"label",Value:i.email}]}):0<e&&(a="api#postchat#submitted"),r.viewManager.hideBusy(),r.viewManager.showForm(a,n,null,"api#chat#close",function(){r.viewManager.closeChat(),r.viewManager.hideForm()})}).failure(function(e){"use strict";u(e),r.viewManager.closeChat(),r.viewManager.hideForm()})},this._unavailableFormSubmitted=function(e){r.viewManager.hideForm(),e.email&&e.subject&&e.body?r.client.submitUnavailableEmail(e.email,e.subject,e.body).success(function(){r.viewManager.hideForm(),r.viewManager.hideCloseButton(),r.viewManager.showForm("api#unavailable#emailed",null,null,"api#chat#close",function(){"use strict";r.viewManager.closeChat(),r.viewManager.hideForm()})}).failure(function(e){"use strict";u(e),r.viewManager.closeChat(),r.viewManager.hideForm()}):r.viewManager.closeChat()},this._chatEnded=function(e){bc.util.log("session:this_chatEnded"),r.viewManager.hideChatInteraction(),r._processChatEndData(e)},this._chatEndedByOpSubmitted=function(e){r.viewManager.hideForm(),r.client.getPostChatFormIfAvail()},this._chatEndedByOp=function(e){bc.util.log("session:this_chatEndeByOp"),r.viewManager.hideChatInteraction(),r.viewManager.showForm("api#chat#operator_ended",null,null,"api#chat#close",r._chatEndedByOpSubmitted,null,null,!0)},this._processChatEndData=function(e){if(r.viewManager.hideBusy(),e&&e.PostChat){var t="api#postchat#intro",a="api#email#transcript";e.PostChat.Fields&&1===e.PostChat.Fields.length&&e.PostChat.Fields[0].Key&&"email"===e.PostChat.Fields[0].Key&&(t="api#email#transcript",a=null),r.viewManager.showForm(t,e.PostChat,null,"api#postchat#done",r._postChatFormSubmitted,null,a,!0)}else r.viewManager.showForm("api#chat#ended",null,null,"api#chat#close",function(){r.viewManager.closeChat(),r.viewManager.hideForm()},null,null,!0)},this.minimizeChat=function(){clearTimeout(c),r.viewManager.minimizeChat()},this.changeMinimizedStatus=function(e){r.client.changeMinimizedStatus(e)},this.isMinimized=function(){return r.client.isMinimized()},this.client.updateChat(this._updateChat),this.client.updateTyper(this._updateTyper),this.client.autoMessage(this._autoMessage),this.client.updateBusy(this._updateBusyQueue),this.client.addMessage(this._addMessage),this.client.chatEnded(this._chatEnded),this.client.chatEndedByOp(this._chatEndedByOp)},(bc=window.bc=window.bc||{}).ViewManager=function(e){var h=this,n=!1,r=[],g=!1,o=document.getElementById("bc-chat-history"),m=document.getElementById("bc-send-msg-text"),u=document.getElementById("bc-status-msg"),i=document.getElementById("bc-queue-wrap"),s=document.getElementById("bc-queue-prompt"),c=document.getElementById("bc-typing"),d=document.getElementById("bc-msg-op-template"),b=document.getElementById("bc-msg-vis-template"),f=document.getElementById("bc-msg-sys-template");this.localizer=new bc.Localizer,this.formBuilder=e||new bc.FormBuilder(this.localizer),this.session=null,this.createdForm=null,this.setLocalizationValues=function(e){h.localizer.setLocalizationValues(e)},this.changeDepartments=function(e){h.formBuilder.changeDepartments(e,h.createdForm.formItems)},this.getLocalizedValue=function(e){return h.localizer.getLocalizedValue(e)};function p(e){e&&bc.util.removeClass(e,"bc-hidden")}function v(e){e&&bc.util.addClass(e,"bc-hidden")}this.showBusy=function(){p(document.getElementsByClassName("bc-busy"))},this.hideBusy=function(){v(document.getElementsByClassName("bc-busy"))},this.showForm=function(e,t,a,i,n,s,r,c){var l=document.getElementById("bc-form-wrapper");if(l){c=c||!1;var o=document.getElementById("bc-form-container");h.createdForm=h.formBuilder.createForm(e,t,a,i,n,h._languageChangeCallback,s,r,null),c&&(o.innerHTML=""),o.appendChild(h.createdForm.form),l.setAttribute("data-form-id",Math.random().toString()),p(l),h.scrollToBottom(l)}},this._languageChangeCallback=function(e){h.session.setLanguage(e)},this.hideForm=function(){var e=document.getElementById("bc-form-wrapper");if(e){var t=o.getElementsByTagName("form"),a=e.getAttribute("data-form-id");v(e),bc.util.removeElement(t),h.scrollToBottom(e);var i=e.getAttribute("data-form-id");i&&i!==a?v(e):e.setAttribute("data-form-id","")}},this.showChatForm=function(){var e=document.getElementById("bc-chat-actions");p(e),p(document.getElementById("bc-end-chat")),bc.util.setAttribute(e,"style","bottom: 0;"),bc.util.setAttribute(document.getElementsByClassName("bc-slide-with-actions"),"style","bottom:"+bc.util.getHeight(e)+"px;")},this.hideMessages=function(e){for(var t=document.querySelectorAll(".bc-msg-vis, .bc-msg-op"),a=t.length-1;0<=a;a--)v(t[a])},this.hideChatInteraction=function(){"use strict";v(document.getElementById("bc-chat-actions")),bc.util.setAttribute(document.getElementsByClassName("bc-slide-with-actions"),"style","bottom:0;")},this.hideCloseButton=function(){"use strict";v(document.getElementById("bc-end-chat"))},this.showCloseButton=function(){"use strict";p(document.getElementById("bc-end-chat"))},this.showStatusMessage=function(e){if(u){var t=u.getElementsByClassName("bc-msg-txt");bc.util.setHtml(t,e),p(u)}},this.hideStatusMessage=function(){u&&v(u)},this.showOrUpdateQueueMessage=function(e,t){"use strict";if(s&&i){s.hasAttribute("data-l10n-prefix")||s.setAttribute("data-l10n-prefix","api#chat#queue_position"),s.setAttribute("data-l10n",e),s.textContent=e.toString();var a=i.querySelector("#bc-queue-cancel");a&&(t?p(a):v(a)),h.localizer.updateLocalizedValues(i),p(i),h.scrollToBottom(i)}},this.hideQueueMessage=function(){"use strict";v(i)},this.notifyMinimizeButton=function(){"use strict";if(h.session.isMinimized){var e=document.getElementById("bc-minimized-indicator");return bc.util.removeClass(e,"bc-notify"),setTimeout(function(){bc.util.addClass(e,"bc-notify")},200)}return null},this.minimizeChat=function(){"use strict";document.getElementById("bc-min-chat").click()};function l(){var e,t,a=0,i=null;for(var n in r){i||(i=document.createElement("div")),0<a&&i.appendChild(bc.util.createElement("span",{"data-l10n":"api#chat#and_conjuction",class:"bc-mar-right"}));var s=(e=r[n].data.operatorAvatar,t=void 0,bc.config.displayTypingOperatorImage&&(t=e?bc.util.createElement("img",{class:"bc-typing-avatar",src:e}):bc.util.createElement("span",{class:"bc-typing-avatar bc-msg-avatar-op"})),t||"");s&&i.appendChild(s),i.appendChild(bc.util.createElement("span",{class:"bc-typing-name"},r[n].data.operatorName)),a++}1<a?i.appendChild(bc.util.createElement("span",{"data-l10n":"api#chat#are_typing"})):0<r.length&&i.appendChild(bc.util.createElement("span",{"data-l10n":"api#chat#is_typing"})),c&&(document.getElementById("bc-typers").innerHTML=i?i.innerHTML:"",h.localizer.updateLocalizedValues(c),p(c),h.scrollToBottom(c))}function y(e,t){for(var a=0;a<e.length;a++)if(e[a].id===t)return a;return!1}this.setOperatorTyping=function(e,t,a){a&&!1===y(r,a)&&(r.push({id:a,data:{operatorName:e,operatorAvatar:t}}),l())},this.clearOperatorTypers=function(){r=[],c&&v(c)},this.hideOperatorTyping=function(e){var t=y(r,e);!1!==t&&(r.splice(t,1),0===r.length?h.clearOperatorTypers():l())};function C(e,t,a,i){return a=a||"_self",t&&this.parent&&this.parent.opener&&this.parent.bcMessageId&&this.parent.bcMessageId===i&&(t=!1),t&&(-1===e.indexOf("http")&&(e="http://"+e),"_self"===a?(this.bcMessageId=i,this.opener||(this.opener&&this.opener.top&&this.opener.top!==this.top&&(this.top=this.opener.top),this.opener=this),this.opener.location.href=e):window.open(e,a)),"["+(t?"opened":"open")+': <a href="'+e+'" target="_blank">'+e+"</a>]"}function w(e,t,a,i,n){for(var s,r,c=0,l="";;){if(-1===(s=e.indexOf(t,c))){l+=e.substring(c);break}if(-1===(r=e.indexOf(a))){l+=e.substring(c);break}l+=e.substring(c,s);var o=s+t.length;try{l+=C(e.substring(o,r),i,null,n)}catch(e){bc.util.log("encodePushTagError",!1,e)}c=r+a.length}return l}this.initializeMessageElement=function(e,t,a,i,n,s){"use strict";if(a===bc.PersonType.Visitor)e=b.cloneNode(!0);else if(a===bc.PersonType.Operator){e=d.cloneNode(!0);var r=document.getElementById("bc-title-operator"),c=document.getElementById("bc-title-operator-name"),l=document.getElementById("bc-title-operator-avatar");bc.util.removeClass(r,"bc-hidden"),bc.util.setText(c,s),n&&bc.util.setText(l,n)}else a===bc.PersonType.System&&(e=f.cloneNode(!0));return e.setAttribute("id",t),v(e),u&&u.parentNode===o?o.insertBefore(e,u):o.appendChild(e),bc.util.setText(e.getElementsByClassName("bc-msg-time"),i.toLocaleTimeString()),g=!1,e},this.addOrUpdateMessage=function(e,t,a,i,n,s,r,c){var l=!1,o=document.getElementById(e.toString());o||(o=h.initializeMessageElement(o,e,t,i,s,a),l=void 0===r),bc.util.setText(o.getElementsByClassName("bc-msg-name"),a),-1<n.indexOf("<push>")&&-1===n.indexOf("[push]")&&(n=w(w(n,"<push>","</push>",l,e),"[push]","[/push]",l,e));var u=o.getElementsByClassName("bc-msg-txt");if(bc.util.setHtml(u,n),void 0!==c&&function(e,t){if(void 0!==e){var a=bc.util.createElement("DIV",{class:"bc-translation-container"});a.style.display="none";var i=h.localizer.getLocalizedValue("api#chat#toggle#show")||"Show original >> ",n=h.localizer.getLocalizedValue("api#chat#toggle#hide")||"<< Hide original ",s=bc.util.createElement("SPAN",{class:"bc-translation-toggle","data-l10n":"api#chat#toggle#show"},i);s.onclick=function(){var e=s.nextSibling,t="none"===e.style.display;e.style.display="none"===e.style.display?"":"none",bc.util.setAttribute(s,"data-l10n",t?"api#chat#toggle#hide":"api#chat#toggle#show"),bc.util.setText(this,"none"===e.style.display?i:n),h.localizer.updateLocalizedValues(a)},a.appendChild(s),h.localizer.updateLocalizedValues(a);var r=bc.util.createElement("DIV",{class:"bc-translation-body"});bc.util.setHtml(r,t),r.style.display="none",a.appendChild(r),a.style.display="",e.appendChild(a)}}(u[0],c),s){var d=o.getElementsByClassName("bc-msg-avatar");d&&("IMG"===d.tagName?bc.util.setAttribute(d,"src",s):bc.util.setStyle(d,"backgroundImage","url('"+s+"')"),p(d))}p(o),h.scrollToBottom(o)},this.scrollToBottom=function(e,t){if(!n&&o){n=!0;var a=o.scrollHeight;if(e){var i=e.getBoundingClientRect().height;i>bc.util.getHeight(o)&&(a-=i)}o.scrollTop=a,t&&t(),n=!1}},this.closeChat=function(){window.close()},this.showError=function(e){"use strict";var t=document.getElementById("bc-form-wrapper"),a=document.getElementById("bc-form-container"),i=h.formBuilder.createErrorForm("api#generic#error_title",e);a.appendChild(i),t.setAttribute("data-form-id",Math.random()),p(t),h.scrollToBottom(t)},this.initialize=function(e){this.session=e;var t=document.getElementById("bc-send-msg-btn");t&&t.addEventListener("click",function(){var e=m.value;if(e&&0<e.length){e=function(e){return 1<e.length?e.substr(0,e.length-1)+e[e.length-1].replace(/ {2,}/g," ").replace(/[\n\r]*/g,""):e}(e);var t=h.session.addVisitorMessage(e),a=new Date,i=h.session.getVisitorName();h.addOrUpdateMessage(t,bc.PersonType.Visitor,i,a,e),m.value=""}});var a=document.getElementById("bc-email");a&&a.addEventListener("click",function(){h.hideChatInteraction(),p(document.getElementById("bc-email-prompt")),v(document.getElementById("bc-email-sent")),p(document.getElementById("bc-email-form")),document.getElementById("bc-email-address").focus()});var i=document.getElementById("bc-email-send");i&&i.addEventListener("click",function(){var e=document.getElementById("bc-email-address").value;e&&0<=e.indexOf("@")&&(h.session.setEmailTranscript(e),v(document.getElementById("bc-email-prompt")),p(document.getElementById("bc-email-sent")),document.getElementById("bc-email-cancel").click())});var n=document.getElementById("bc-email-cancel");n&&n.addEventListener("click",function(){p(document.getElementById("bc-email-form")),h.showChatForm()});var s=document.getElementById("bc-print");s&&s.addEventListener("click",function(){window.print()});var r=document.getElementById("bc-queue-cancel-btn");r&&r.addEventListener("click",function(e){e.preventDefault(),h.session.cancelQueueWait()});window.addEventListener("orientationchange",function(){document.activeElement.blur()});var c=document.getElementById("bc-end-chat");c&&c.addEventListener("click",function(){h.hideQueueMessage(),h.clearOperatorTypers(),h.session.endChat()});var l=document.getElementById("bc-end");l&&l.addEventListener("click",function(){h.hideQueueMessage(),h.clearOperatorTypers(),h.session.endChat()});var o=document.getElementById("bc-min-chat"),u=document.getElementById("bc-layered-chat"),d=document.getElementById("bc-minimized-indicator");o&&o.addEventListener("click",function(){bc.util.removeClass(d,"bc-notify"),bc.util.addClass(u,"bc-minimized"),h.session.changeMinimizedStatus(!0)}),d&&d.addEventListener("click",function(){bc.util.removeClass(d,"bc-notify"),bc.util.removeClass(u,"bc-minimized"),h.session.changeMinimizedStatus(!1)}),window.addEventListener("resize",function(){h.scrollToBottom()}),m&&(m.addEventListener("keyup",function(e){var t=e||window.event,a=t.which?t.which:t.keyCode?t.keyCode:0,i=!!this.value;if(13===a&&!t.shiftKey)return document.getElementById("bc-send-msg-btn").click(),e.preventDefault(),h.session.setVisitorTyping(!1),g=!1;g!==i&&(g=!!i,h.session.setVisitorTyping(g))}),m.addEventListener("keyup",function(){var e=!!this.value;if(!e&&g!==e)return h.session.setVisitorTyping(!1),g=e,!1}))}};